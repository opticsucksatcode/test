<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brat Cover Generator</title>
<style>
  body {
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: Arial, sans-serif;
    background: #fff;
  }

  #cover {
    width: 70vmin;
    height: 70vmin; /* perfect square */
    background: #d0ff14;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    text-align: center;
    padding: 5%;
    box-sizing: border-box;
  }

  #cover span {
    display: inline-block;
    font-size: 10vmin; /* default font size */
    font-weight: 400;
    text-transform: lowercase;
    color: black;
    line-height: 1;
    transform: scaleX(1.3);
    filter: blur(0.8px) contrast(110%) saturate(120%);
    white-space: pre-wrap;
    word-break: break-word;
  }

  input {
    margin-top: 20px;
    padding: 10px;
    font-size: 1rem;
    width: 300px;
    text-align: center;
  }

  button {
    margin-top: 10px;
    padding: 10px 20px;
    font-size: 1rem;
    cursor: pointer;
  }

  #commands {
    margin-top: 20px;
    width: 70vmin;
    font-size: 0.9rem;
    background: #eee;
    padding: 10px;
    border-radius: 5px;
  }
</style>
</head>
<body>

<div id="cover"><span>brat</span></div>
<input type="text" id="textInput" placeholder="Type your brat text..." />
<button onclick="downloadCover()">Download Cover</button>

<div id="commands">
<h3>Commands / Customizations:</h3>
<ul>
<li><code>&lt;blank&gt;</code> → removes all text</li>
<li><code>&lt;bg:HEX&gt;</code> → sets background color (e.g., &lt;bg:#ff0000&gt;)</li>
<li><code>&lt;t:HEX&gt;</code> → sets text color (e.g., &lt;t:#0000ff&gt;)</li>
<li><code>&lt;b&gt;TEXT&lt;/b&gt;</code> → bold text</li>
<li><code>&lt;i&gt;TEXT&lt;/i&gt;</code> → italic / slanted text</li>
<li><code>&lt;u&gt;TEXT&lt;/u&gt;</code> → underline text</li>
</ul>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
const cover = document.getElementById("cover");
const span = cover.querySelector("span");
const input = document.getElementById("textInput");

function applyCustomText(rawText) {
  // Handle <blank>
  if(rawText.trim() === "<blank>") return "";

  let bg = "#d0ff14"; // default background
  let textColor = "black"; // default text color
  let processedText = rawText;

  // Change background color
  const bgMatch = rawText.match(/<bg:([#a-fA-F0-9]{3,6})>/);
  if(bgMatch) {
    bg = bgMatch[1].startsWith("#") ? bgMatch[1] : "#" + bgMatch[1];
    processedText = processedText.replace(bgMatch[0], "");
  }

  // Change text color
  const tMatch = rawText.match(/<t:([#a-fA-F0-9]{3,6})>/);
  if(tMatch) {
    textColor = tMatch[1].startsWith("#") ? tMatch[1] : "#" + tMatch[1];
    processedText = processedText.replace(tMatch[0], "");
  }

  cover.style.background = bg;
  span.style.color = textColor;

  // Return the text as HTML to support <b>, <i>, <u>
  return processedText;
}

function adjustFontSize() {
  let fontSize = 10; // default font size from your script
  span.style.fontSize = fontSize + "vmin";

  while ((span.scrollWidth > cover.clientWidth * 0.95 ||
          span.scrollHeight > cover.clientHeight * 0.95) &&
          fontSize > 4) {
    fontSize -= 1;
    span.style.fontSize = fontSize + "vmin";
  }
}

input.addEventListener("input", () => {
  const customText = applyCustomText(input.value || "brat");
  span.innerHTML = customText;
  adjustFontSize();
});

// Initialize with default
span.innerHTML = applyCustomText("brat");
adjustFontSize();

function downloadCover() {
  html2canvas(cover).then(canvas => {
    const link = document.createElement("a");
    link.download = "brat_cover.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}
</script>
</body>
</html>
